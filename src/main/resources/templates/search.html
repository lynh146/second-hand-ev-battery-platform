<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Tìm kiếm - EV MARKET</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/search.css">
</head>
<body>

<!-- HEADER -->
<div th:replace="fragments/header :: header"></div>

<section class="container py-4">

    <!-- FILTER BAR -->
    <form id="filterForm"
          class="d-flex flex-wrap align-items-center gap-2 mb-3"
          method="get" action="/search">

        <!-- LEFT SIDE -->
        <button type="button"
                class="filter-pill"
                data-bs-toggle="modal"
                data-bs-target="#filterModal">
            <i class="fa-solid fa-sliders me-1"></i> Lọc
        </button>

        <select name="category" class="filter-select">
            <option value="" th:selected="${category == null}">Danh mục</option>
            <option value="vehicle" th:selected="${category == 'vehicle'}">Xe điện</option>
            <option value="battery" th:selected="${category == 'battery'}">Pin EV</option>
        </select>

        <!-- CLEAR -->
        <div class="ms-auto">
            <a th:href="@{/search(keyword=${keyword})}" class="small text-decoration-none">Xoá lọc</a>
        </div>

        <!-- HIDDEN PARAMETERS -->
        <input type="hidden" name="keyword" id="keywordField" th:value="${keyword}">
        <input type="hidden" name="minPrice" id="minPriceField" th:value="${minPrice}">
        <input type="hidden" name="maxPrice" id="maxPriceField" th:value="${maxPrice}">
        <input type="hidden" name="brand" id="brandField" th:value="${brand}">
    </form>

    <!-- RESULT TITLE -->
    <h5 class="fw-bold mb-3">
        Kết quả tìm kiếm
        <span class="text-muted small" th:if="${keyword}">
            cho từ khóa "<span th:text="${keyword}"></span>"
        </span>
    </h5>

    <!-- LIST RESULTS -->
    <div class="row g-3" th:if="${results != null && !results.isEmpty()}">
        <div class="col-12 col-md-4" th:each="item : ${results}">
            <a th:href="@{|/listings/${item.listingID}|}" class="card h-100 text-decoration-none text-dark">

                <div class="ratio ratio-4x3">
                    <img th:if="${item.images != null && !item.images.isEmpty()}"
                         th:src="${item.images[0].imageUrl}"
                         class="card-img-top object-fit-cover">
                    <div th:if="${item.images == null || item.images.isEmpty()}"
                         class="d-flex align-items-center justify-content-center bg-light">
                        <i class="fa-solid fa-car-battery fa-2x text-secondary"></i>
                    </div>
                </div>

                <div class="card-body">
                    <h6 class="fw-bold mb-1" th:text="${item.title}"></h6>

                    <p class="text-danger fw-bold mb-1"
                       th:text="${#numbers.formatDecimal(item.price,0,'POINT',0,'POINT')} + ' đ'"></p>

                    <p class="small text-muted">
                        Đăng bởi <span th:text="${item.user != null ? item.user.fullName : 'Người bán'}"></span>
                        • <span th:text="${#temporals.format(item.createdAt,'dd/MM/yyyy')}"></span>
                    </p>
                </div>
            </a>
        </div>
    </div>

    <!-- EMPTY -->
    <p class="text-muted fst-italic" th:if="${results == null || results.isEmpty()}">
        Không tìm thấy tin đăng phù hợp.
    </p>

</section>


<!-- MODAL FILTER -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content filter-modal">

            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">Lọc kết quả</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <!-- BRAND -->
                <label class="form-label fw-semibold small">Hãng xe / pin</label>
                <input id="brandInput" class="form-control mb-3"
                       placeholder="VD: VinFast, Tesla..." th:value="${brand}">

                <!-- PRICE RANGE -->
                <label class="form-label fw-semibold small">Khoảng giá (VNĐ)</label>

                <div class="price-range-container mb-2">
                    <input type="range" id="minRange" min="0" max="100000000" step="1000000">
                    <input type="range" id="maxRange" min="0" max="100000000" step="1000000">
                </div>

                <div class="row g-2">
                    <div class="col-6">
                        <input id="minPriceInput" type="number" class="form-control" placeholder="Giá tối thiểu">
                    </div>
                    <div class="col-6">
                        <input id="maxPriceInput" type="number" class="form-control" placeholder="Giá tối đa">
                    </div>
                </div>

                <div class="form-text small">Nhập giá VNĐ. Ví dụ: 12000000 = 12 triệu.</div>
            </div>

            <div class="modal-footer border-0 pt-0">
                <button id="btnClearFilter" class="btn btn-outline-secondary flex-grow-1">Xoá lọc</button>
                <button id="btnApplyFilter" class="btn btn-dark flex-grow-1">Áp dụng</button>
            </div>

        </div>
    </div>
</div>

<!-- FOOTER -->
<div th:replace="fragments/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/header.js}"></script>
<script th:src="@{/js/search.js}"></script>

</body>
</html>
