<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Chi tiết giao dịch - EV MARKET</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">

    <style>
        .info-box {
            padding: 18px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
    </style>
</head>

<body>

<div th:replace="fragments/header :: header"></div>

<section class="container py-5">

    <h2 class="fw-bold mb-4">
        <i class="fa-solid fa-file-invoice-dollar me-2"></i>
        Chi tiết giao dịch
    </h2>

    <div class="info-box">

        <!-- GENERAL INFO -->
        <h5 class="fw-bold mb-3">Thông tin giao dịch</h5>

        <p><strong>Mã giao dịch:</strong> <span th:text="${tx.transactionID}"></span></p>

        <p>
            <strong>Sản phẩm:</strong>
            <a th:href="@{'/listings/' + ${tx.listing.listingID}}"
               class="text-decoration-none fw-bold">
                <span th:text="${tx.listing.title}"></span>
            </a>
        </p>

        <p>
            <strong>Số tiền:</strong>
            <span class="text-danger fw-bold"
                  th:text="${#numbers.formatInteger(tx.totalAmount, 3, 'POINT')} + ' đ'"></span>
        </p>

        <p>
            <strong>Trạng thái:</strong>
            <span class="badge px-3"
                  th:classappend="${tx.status == 'SUCCESS' ? 'bg-success'
                                   : tx.status == 'FAILED' ? 'bg-danger'
                                   : 'bg-secondary'}"
                  th:text="${tx.status}">
            </span>
        </p>

        <p>
            <strong>Ngày tạo:</strong>
            <span th:text="${#temporals.format(tx.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
        </p>

        <!-- SELLER / BUYER INFO -->
        <hr>
        <h5 class="fw-bold mb-3">Thông tin người bán / mua</h5>

        <p><strong>Người mua:</strong> <span th:text="${tx.buyer.fullName}"></span></p>
        <p><strong>Người bán:</strong> <span th:text="${tx.seller.fullName}"></span></p>

        <!-- REVIEW BUTTON -->
        <hr>

        <div>
            <h5 class="fw-bold">Đánh giá</h5>

            <a th:if="${tx.review == null and tx.status == 'SUCCESS'}"
               th:href="@{'/member/reviews/form/' + ${tx.transactionID}}"
               class="btn btn-primary mt-2">
                Đánh giá giao dịch
            </a>

            <span th:if="${tx.review != null}" class="text-success fw-bold">
                ✓ Bạn đã đánh giá giao dịch này
            </span>
        </div>

    </div>

</section>

<footer th:replace="fragments/footer :: footer"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/header.js}"></script>

</body>
</html>
